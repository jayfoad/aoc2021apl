⎕IO←0 ⋄ ⎕PP←17
p←'n'=1⊃¨p⊣q←0 1+⍤1⍎¨↑3 2∘⍴¨'-?\d+'⎕S'&'¨p←⊃⎕NGET'p22.txt'1
to←{⍺+⍳⍵-⍺}
z←0⍴⍨3/100 ⋄ (m⌿p){z[⊃∘.,/to/⍤1⊢⍵]←⍺}⍤¯1⊢50+q⌿⍨m←50≥⌈/⌈/|q ⋄ +/,z ⍝ part 1
k←⍉2 2 2⊤⍳8
s←{l u←⊂[0 1]⍵ ⋄ {⍵⌿⍨∧/</⍵}2↑⍤1,[0 1]k⌽⍤1 2⍤1 3⊢l,u,[1.5]⍨l⌈u⌊⍺⍴⍨⍴l} ⍝ split
ss←{((⊢/⍺)s(⊣/⍺)s m⌿⍵)⍪⍵⌿⍨~m←∧/((⊣/⍺)≤⍤1⊢/⍵)∧(⊣/⍵)≤⍤1⊢/⍺} ⍝ selective split
f←{⍵⌿⍨~∧/((⊣/⍺)≤⍤1⊣/⍵)∧(⊢/⍵)≤⍤1⊢/⍺} ⍝ filter
z←0 3 2⍴0 ⋄ p{z∘←(⍵ f ⍵ ss z)⍪⍺ 3 2⍴⍵}⍤¯1⊢q ⋄ +/×/--/z ⍝ part 2
